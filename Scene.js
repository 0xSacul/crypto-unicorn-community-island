"use strict";(()=>{var m={body:"Beige Farmer Potion",hat:"Unicorn Horn",hair:"Sun Spots",shirt:"Red Farmer Shirt",pants:"Farmer Pants",tool:"Farmer Pitchfork"},c={body:"Goblin Potion",hat:"Unicorn Hat",hair:"Sun Spots",shirt:"SFL T-Shirt",pants:"Farmer Pants",tool:"Pirate Scimitar"},a=[{name:"starlight",image:"https://sunflower-land.github.io/crypto-unicorn-community-island/starlight.png",coordinates:{x:405,y:453},introduction:"Welcome stranger to our beautiful island.",conclusion:"Thank you for satisfying my hungry children!",requirements:{items:{},label:""},promoRequirements:{items:{},label:""}},{name:"sparklehoof",image:"https://sunflower-land.github.io/crypto-unicorn-community-island/sparklehoof.png",coordinates:{x:541,y:293},requirements:{items:{Potato:200},label:"200 Potatoes"},promoRequirements:{items:{Potato:20},label:"20 Potatoes"},introduction:"Hey there! The name's Sparklehoof. To satisfy my hunger, I crave potatoes!",conclusion:"Ha-ha! You've cracked me up with your potatoes! Keep laughing and spreading joy!"},{name:"thunderdash",image:"https://sunflower-land.github.io/crypto-unicorn-community-island/thunderdash.png",coordinates:{x:399,y:110},requirements:{items:{Carrot:300},label:"300 Carrots"},promoRequirements:{items:{Carrot:30},label:"30 Carrots"},introduction:"Yo! Thunderdash here! I love racing through the fields, feeling the wind on my mane. A lightning-quick sugar carrot would be the ultimate fuel to keep my energy high!",conclusion:"Whoosh! The sugar carrot has electrified my energy! With thundering gratitude, I thank you for your swift gift. Let's embark on more adventures together!"},{name:"blossom",image:"https://sunflower-land.github.io/crypto-unicorn-community-island/blossom.png",coordinates:{x:156,y:142},requirements:{items:{Cauliflower:100},label:"100 Cauliflowers"},promoRequirements:{items:{Cauliflower:10},label:"10 Cauliflowers"},introduction:"Greetings! I'm Blossom. I spend most of my time tending to the flowers and plants of Sunflower Land. A collection of cauliflowers would satisfy me!",conclusion:"A garden of thanks to you, kind soul! Your gift of cauliflowers nourishes both body and spirit. May the flowers bloom in your path!"},{name:"moonbeam",image:"https://sunflower-land.github.io/crypto-unicorn-community-island/moonbeam.png",coordinates:{x:135,y:294},requirements:{items:{Sunflower:1e3},label:"1000 Sunflowers"},promoRequirements:{items:{Sunflower:100},label:"100 Sunflowers"},introduction:"Hello, kind stranger. I'm Moonbeam. I find solace in the moon's glow and seek knowledge from ancient tomes. However, I also need some sun in my life to survive. To satisfy my hunger, I desire Sunflowers.",conclusion:"Greetings, wise one! Your gift of radiant Sunflowers has filled me with celestial wisdom. May the moonlight guide you on your journey to enlightenment!"}],n=new window.CommunityAPI({id:"unicorn_island",apiKey:"79005d5f-8019-4d6a-bc57-6b3f0763ab73"}),s=class extends window.BaseScene{constructor(){super({name:"unicorn_island",map:{padding:[1,2],tilesetUrl:"https://sunflower-land.com/testnet-assets/world/map-extruded.png"},player:{spawn:{x:351,y:500}}});this.progress={unicornsFedAt:{}};this.feed=async e=>{if(window.openModal({type:"loading"}),this.progress.unicornsFedAt[e])throw new Error(`${e} already fed`);let i={...this.progress,unicornsFedAt:{...this.progress.unicornsFedAt??{},[e]:Date.now()}},o=a.find(l=>l.name===e)?.requirements.items;await n.burn({metadata:JSON.stringify(i),items:o}),this.progress=i,window.closeModal()};this.mint=async()=>{if(window.openModal({type:"loading"}),this.progress?.hornMintedAt)throw new Error("Horn already minted");let e={...this.progress,hornMintedAt:Date.now()};await n.mint({metadata:JSON.stringify(e),wearables:{"Unicorn Horn":1}}),this.progress=e,window.closeModal(),window.openModal({type:"speaking",messages:[{text:"You can now equip your horn and become beautiful like me!"},{text:"Return anytime - A unicorn's hunger is not satisfied for long."}]})}}preload(){super.preload(),a.forEach(e=>{this.load.image(e.name,e.image)})}create(){super.create(),a.forEach(o=>{this.add.sprite(o.coordinates.x,o.coordinates.y,o.name).setInteractive({cursor:"pointer"}).on("pointerdown",()=>{if(o.name==="starlight"){let t=this.progress.unicornsFedAt??{};return!!t.blossom&&t.moonbeam&&t.sparklehoof&&t.thunderdash?this.progress.hornMintedAt?window.openModal({type:"speaking",messages:[{text:"You can now equip your horn and become beautiful like me!"},{text:"Return anytime - A unicorn's hunger is not satisfied for long."}]}):window.openModal({type:"speaking",messages:[{text:"I knew I could count on you!"},{text:"As promised, here is a Unicorn Horn.",actions:[{text:"Claim",cb:this.mint}]}]}):window.openModal({type:"speaking",messages:[{text:"Welcome to our beautiful island!"},{text:"How strange...you don't have a horn? You must be a Bumpkin!"},{text:"That's perfect - that must mean you have plenty of crops!"},{text:"My children are starving and can use your help. If you can feed all 4 of my children I will reward you with your very own Unicorn Horn."},{text:"You can find them scattered around this island. Good luck!"}]})}if(this.progress.unicornsFedAt[o.name]){window.openModal({type:"speaking",messages:[{text:o.conclusion}]});return}let h=n.user;console.log({user:h});let r=o.requirements;n.user?.promoCode==="UNICORN"&&(r=o.promoRequirements);let d=n.game.inventory,p=Object.keys(r.items).every(t=>!!d[t]&&d[t].gte(r.items[t])),u=o.introduction;p?window.openModal({type:"speaking",messages:[{text:u},{text:"It looks like you have what I need!",actions:[{text:`Feed (${o.requirements.label})`,cb:()=>{this.feed(o.name)}}]}]}):window.openModal({type:"speaking",messages:[{text:u},{text:`Oh no, you don't have what I need. (${o.requirements.label})`}]})})}),this.initialiseNPCs([{x:314,y:256,clothing:c,onClick:()=>{window.openModal({npc:{name:"Nelly",clothing:c},type:"speaking",messages:[{text:"Neighhhhhhhh! What a magical place! "}]})}},{x:301,y:464,npc:"Stardust",clothing:m,onClick:()=>{window.openModal({npc:{name:"Stardust",clothing:m},type:"speaking",messages:[{text:"Neighhhhhhhh, welcome to Unicorn Island!"},{text:"Sunflower Land has partnered with Crypto Unicorns to bring you this cross-over event."},{text:"For a limited time I'm giving Crypto Unicorn lootboxes to Unicorns."},...this.progress.hornMintedAt?[{text:"Wow, that is a beautiful horn you have. You must be a unicorn!!!",cb:()=>window.open("https://docs.sunflower-land.com/player-guides/special-events/crypto-unicorns-quest","_blank")},{text:"You might be eligible for the Lootbox giveaway!",actions:[{text:"View Giveaway Conditions",cb:()=>window.open("https://docs.sunflower-land.com/player-guides/special-events/crypto-unicorns-quest","_blank")}]}]:[{text:"Huh, that's strange. You don't look like a Unicorn.",actions:[{text:"View Giveaway Conditions",cb:()=>window.open("docs.sunflower-land.com","_blank")}]}]]})}}]),this.initialise(),this.events.on("shutdown",()=>{this.cache.tilemap.remove("unicorn_island"),this.scene.remove("unicorn_island")}),this.input.keyboard.addKey("SPACE").on("down",()=>{this.scene.start("default")}),this.input.keyboard.addKey("r").on("down",async()=>{await n.reset(),this.scene.start("default")})}async initialise(){window.openModal({type:"loading"});let e=await n.loadIsland();e?.metadata?this.progress=JSON.parse(e.metadata):this.progress={unicornsFedAt:{}},window.closeModal()}update(){super.update()}};window.ExternalScene=s;})();
